<!DOCTYPE html>
<html lang="vi">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Music Space</title>
  <link rel="stylesheet" href="assets/style.css" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
</head>

<body>
  <!-- NAVBAR -->
  <nav class="navbar">
    <div class="nav-inner">
      <!-- Logo -->
      <a class="brand" href="#">
        <span class="logo">‚ù§</span>
        <span><strong>Music</strong> <span class="space">Space</span></span>
      </a>

      <!-- Menu -->
      <div class="nav-links">
        <a href="#" class="chip">‚ú® I'm Healing</a>
        <!-- B·∫Øt bu·ªôc ƒëƒÉng nh·∫≠p -->
        <a href="pages/healing-space.html" class="chip" id="linkHealing" data-auth-required>üó∫ Healing Space</a>
        <a href="#" class="chip">üë• We Share</a>
        <a href="#" class="chip">üìñ We Read</a>
      </div>

      <!-- Actions -->
      <div class="nav-actions">
        <button class="icon-btn">üîà</button>
        <div class="user-box">
          <button class="icon-btn" id="btnUser">üë§</button>
          <div id="user-info"></div>
        </div>
      </div>
    </div>
  </nav>

  <!-- HERO -->
  <header class="hero container" id="top">
    <h1 class="headline">Giai ƒëi·ªáu <span class="heal">ch·ªØa l√†nh</span><br />K·∫øt n·ªëi t√¢m h·ªìn</h1>
    <p class="sub">Bi·∫øn c·∫£m x√∫c th√†nh √¢m nh·∫°c. Kh√°m ph√° kh√¥ng gian v√† s·ª± ki·ªán ch·ªØa l√†nh tr√™n kh·∫Øp Vi·ªát Nam.</p>
    <div class="cta-wrap">
      <a class="btn" href="#features">B·∫Øt ƒë·∫ßu ch·ªØa l√†nh ‚Üí</a>
    </div>
  </header>

  <!-- INTRO -->
  <section class="intro container" id="intro">
    <h2 class="intro-title">
      <svg viewBox="0 0 24 24" width="22" height="22" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M9 18V5l12-2v13"></path>
        <circle cx="6" cy="18" r="3"></circle>
        <circle cx="18" cy="16" r="3"></circle>
      </svg>
      Gi·ªõi thi·ªáu v·ªÅ Music Space
    </h2>

    <div class="intro-card">
      <p>Music Space l√† n·ªÅn t·∫£ng k·∫øt n·ªëi gi·ªØa con ng∆∞·ªùi, kh√¥ng gian v√† √¢m nh·∫°c ‚Äì n∆°i m·ªói n·ªët nh·∫°c tr·ªü th√†nh
        li·ªáu ph√°p ch·ªØa l√†nh, v√† m·ªói ƒë·ªãa ƒëi·ªÉm l√† m·ªôt c√°nh c·ª≠a m·ªü ra s·ª± ƒë·ªìng c·∫£m, s·∫ª chia.</p>
      <p>Ch√∫ng t√¥i x√¢y d·ª±ng b·∫£n ƒë·ªì √¢m nh·∫°c ch·ªØa l√†nh ƒë·∫ßu ti√™n t·∫°i Vi·ªát Nam, n∆°i b·∫°n c√≥ th·ªÉ:</p>

      <ul class="intro-list">
        <li>Kh√°m ph√° c√°c kh√¥ng gian √¢m nh·∫°c c·ªông ƒë·ªìng t·∫°i kh·∫Øp m·ªçi mi·ªÅn t·ªï qu·ªëc.</li>
        <li>T·∫°o v√† c√° nh√¢n ho√° b·∫£n nh·∫°c ch·ªØa l√†nh ri√™ng cho m√¨nh b·∫±ng c√¥ng ngh·ªá AI.</li>
        <li>Ghi l·∫°i c·∫£m x√∫c, l·∫Øng nghe ch√≠nh m√¨nh, v√† k·∫øt n·ªëi v·ªõi nh·ªØng ng∆∞·ªùi ƒë·ªìng c·∫£m.</li>
      </ul>

      <p>V·ªõi s·ª± k·∫øt h·ª£p gi·ªØa √¢m nh·∫°c, c√¥ng ngh·ªá v√† c·ªông ƒë·ªìng, Music Space kh√¥ng ch·ªâ l√† m·ªôt website ‚Äì ƒë√≥ l√†
        h√†nh tr√¨nh ch·ªØa l√†nh, l√† ng√¥i nh√† chung cho nh·ªØng t√¢m h·ªìn ƒëang t√¨m v·ªÅ s·ª± an y√™n.</p>

      <p class="intro-callout">üåø <strong>H√£y ƒë·ªÉ √¢m nh·∫°c d·∫´n l·ªëi b·∫°n tr·ªü v·ªÅ v·ªõi ch√≠nh m√¨nh.</strong></p>
    </div>
  </section>

  <!-- FEATURES -->
  <section class="features container" id="features">
    <h2 class="headline">Tr·∫£i nghi·ªám Music Space</h2>
    <p class="sub">Ba h√†nh tr√¨nh ch√≠nh gi√∫p b·∫°n k·∫øt n·ªëi s√¢u h∆°n v·ªõi √¢m nh·∫°c, c·∫£m x√∫c v√† c·ªông ƒë·ªìng.</p>

    <div class="cards">
      <article class="card">
        <div class="badge blue">
          <svg viewBox="0 0 24 24" width="28" height="28" fill="none" stroke="white" stroke-width="2">
            <path d="M5 12l3-3 3 3-3 3-3-3zm9-7l2 4 4 2-4 2-2 4-2-4-4-2 4-2 2-4z" />
          </svg>
        </div>
        <h3>Ch·ªØa l√†nh c√° nh√¢n</h3>
        <p>T·∫°o playlist t·ª´ c·∫£m x√∫c c·ªßa b·∫°n v·ªõi AI v√† ghi l·∫°i h√†nh tr√¨nh t√¢m tr·∫°ng m·ªói ng√†y.</p>
        <a class="arrow" href="#">Kh√°m ph√° ngay ‚Üí</a>
      </article>

      <article class="card">
        <div class="badge yellow">
          <svg viewBox="0 0 24 24" width="26" height="26" fill="none" stroke="white" stroke-width="2">
            <path d="M3 6l6-3 6 3 6-3v15l-6 3-6-3-6 3zM9 3v15M15 6v15" />
          </svg>
        </div>
        <h3>Kh√¥ng gian & S·ª± ki·ªán</h3>
        <p>Kh√°m ph√° b·∫£n ƒë·ªì c√°c ƒë·ªãa ƒëi·ªÉm v√† tham gia nh·ªØng s·ª± ki·ªán √¢m nh·∫°c ch·ªØa l√†nh g·∫ßn b·∫°n.</p>
        <a class="arrow" href="#">Kh√°m ph√° ngay ‚Üí</a>
      </article>

      <article class="card">
        <div class="badge pink">
          <svg viewBox="0 0 24 24" width="26" height="26" fill="none" stroke="white" stroke-width="2">
            <path d="M16 21v-2a4 4 0 00-4-4H6a4 4 0 00-4 4v2" />
            <circle cx="9" cy="7" r="4" />
            <path d="M22 21v-2a4 4 0 00-3-3.87" />
            <path d="M16 3.13a4 4 0 010 7.75" />
          </svg>
        </div>
        <h3>C·ªông ƒë·ªìng We Share</h3>
        <p>Chia s·∫ª c√¢u chuy·ªán, t√¨m ki·∫øm s·ª± ƒë·ªìng c·∫£m v√† k·∫øt n·ªëi v·ªõi nh·ªØng ng∆∞·ªùi c√πng t·∫ßn s·ªë.</p>
        <a class="arrow" href="#">Kh√°m ph√° ngay ‚Üí</a>
      </article>
    </div>
  </section>

  <!-- FOOTER -->
  <footer class="footer">
    <div class="footer-inner">
      <div class="footer-col">
        <div class="brand-footer">
          <span class="logo">‚ù§</span>
          <div>
            <div class="brand-text"><strong>Music</strong> <span class="space">Space</span></div>
            <p class="tagline">Vietnam's Healing Music Map</p>
          </div>
        </div>
        <p class="desc">N·ªÅn t·∫£ng k·∫øt n·ªëi c·∫£m x√∫c, kh√¥ng gian v√† c·ªông ƒë·ªìng th√¥ng qua giai ƒëi·ªáu ch·ªØa l√†nh.</p>
        <div class="social">
          <a href="#"><i class="fab fa-facebook-f"></i></a>
          <a href="#"><i class="fab fa-instagram"></i></a>
          <a href="#"><i class="fab fa-messenger"></i></a>
          <a href="#"><i class="fab fa-youtube"></i></a>
        </div>
      </div>

      <div class="footer-col">
        <h4>Kh√°m Ph√°</h4>
        <ul>
          <li><a href="#">I'm Healing</a></li>
          <li><a href="#">Healing Space</a></li>
          <li><a href="#">We Share</a></li>
        </ul>
      </div>

      <div class="footer-col">
        <h4>V·ªÅ ch√∫ng t√¥i</h4>
        <ul>
          <li><a href="#">S·ª© m·ªánh</a></li>
          <li><a href="#">We Read</a></li>
        </ul>
      </div>

      <div class="footer-col">
        <h4>ƒê·ªëi T√°c</h4>
        <ul>
          <li><a href="#">Tr·ªü th√†nh ƒë·ªëi t√°c</a></li>
          <li><a href="#">G√≥i th√†nh vi√™n</a></li>
        </ul>
      </div>
    </div>
    <div class="copyright">¬© 2025 Music Space. All rights reserved.</div>
  </footer>

  <!-- AUTH MODAL -->
  <div id="auth-modal" class="auth-modal hidden">
    <div class="auth-dialog">
      <button class="auth-close" aria-label="close">√ó</button>

      <div class="auth-tabs">
        <button data-tab="login" class="auth-tab active">ƒêƒÉng nh·∫≠p</button>
        <button data-tab="register" class="auth-tab">ƒêƒÉng k√Ω</button>
      </div>

      <!-- LOGIN -->
      <form id="form-login" class="auth-pane show">
        <label>Email</label>
        <input type="email" name="email" required placeholder="you@email.com">
        <label>M·∫≠t kh·∫©u</label>
        <input type="password" name="password" required placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">

        <div class="row-right" style="margin:6px 0 10px">
          <button type="button" class="link" id="btnForgot">Qu√™n m·∫≠t kh·∫©u?</button>
        </div>

        <button type="submit" class="auth-btn">ƒêƒÉng nh·∫≠p</button>
        <p class="auth-msg" id="login-msg"></p>
      </form>

      <!-- REGISTER -->
      <form id="form-register" class="auth-pane">
        <label>H·ªç t√™n</label>
        <input type="text" name="fullName" required placeholder="Nguy·ªÖn VƒÉn A">
        <label>Email</label>
        <input type="email" name="email" required placeholder="you@email.com">
        <label>S·ªë ƒëi·ªán tho·∫°i</label>
        <input type="text" name="phone" placeholder="0912 345 678">
        <label>M·∫≠t kh·∫©u</label>
        <input type="password" name="password" required placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
        <button type="submit" class="auth-btn">T·∫°o t√†i kho·∫£n</button>
        <p class="auth-msg" id="register-msg"></p>
      </form>
    </div>
  </div>

  <!-- (tu·ª≥ ch·ªçn) b·ªè d√≤ng d∆∞·ªõi n·∫øu b·∫°n kh√¥ng d√πng file js c≈© -->
  <!-- <script src="js/script.js"></script> -->

  <script>
    const $$ = (s, el = document) => el.querySelector(s);
    const API = '/api';
    const modal = $$('#auth-modal');
    const btnUser = $$('#btnUser');
    const btnClose = $$('.auth-close');
    const tabBtns = document.querySelectorAll('.auth-tab');
    const panes = document.querySelectorAll('.auth-pane');
    const loginMsg = $$('#login-msg');
    const registerMsg = $$('#register-msg');

    function openModal(tab = 'login') { modal.classList.remove('hidden'); switchTab(tab); }
    function closeModal() { modal.classList.add('hidden'); loginMsg.textContent = ''; registerMsg.textContent = ''; }
    function switchTab(tab) {
      tabBtns.forEach(b => b.classList.toggle('active', b.dataset.tab === tab));
      panes.forEach(p => p.classList.toggle('show', p.id === 'form-' + tab));
    }

    btnUser?.addEventListener('click', () => openModal('login'));
    btnClose?.addEventListener('click', closeModal);
    tabBtns.forEach(b => b.addEventListener('click', () => switchTab(b.dataset.tab)));
    modal.addEventListener('click', (e) => { if (e.target === modal) closeModal(); });

    // ch·∫∑n link c·∫ßn ƒëƒÉng nh·∫≠p
    document.querySelectorAll('[data-auth-required]').forEach(a => {
      a.addEventListener('click', (e) => {
        const u = localStorage.getItem('ms_user');
        if (!u) { e.preventDefault(); openModal('login'); }
      });
    });

    // ===== User chip =====
    function renderUser() {
      const box = document.querySelector('#user-info');
      if (!box) return;

      let u = null;
      try { u = JSON.parse(localStorage.getItem('ms_user') || 'null'); } catch { }

      if (!u) { box.innerHTML = ''; return; }

      const name = (u.fullName && u.fullName.trim())
        ? u.fullName.trim()
        : (u.email || '').split('@')[0];

      const isManager = ['manager', 'admin'].includes((u.role || '').toLowerCase());

      box.innerHTML = `
    <div class="user-mini">
      <div class="user-name">${name}</div>
      ${isManager ? `<a href="/pages/manager/manager.html" class="btn-mini">Qu·∫£n tr·ªã</a>` : ''}
      <button id="btnLogout" class="logout-link">ƒêƒÉng xu·∫•t</button>
    </div>
  `;

      document.querySelector('#btnLogout')?.addEventListener('click', () => {
        localStorage.removeItem('ms_user');
        renderUser();
      });
    }


    // G·ªçi khi trang load
    document.addEventListener('DOMContentLoaded', renderUser);

    // ===== LOGIN (c·∫≠p nh·∫≠t l·∫°i) =====
    document.querySelector('#form-login')?.addEventListener('submit', async (e) => {
      e.preventDefault();
      const loginMsg = document.querySelector('#login-msg');
      loginMsg.textContent = 'ƒêang ƒëƒÉng nh·∫≠p...';
      const fd = new FormData(e.target);
      const payload = { email: fd.get('email'), password: fd.get('password') };

      try {
        const r = await fetch('/api/auth/login', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });
        const d = await r.json();
        if (!r.ok) {
          loginMsg.textContent =
            d.error === 'user_not_found' ? 'Email kh√¥ng t·ªìn t·∫°i' :
              d.error === 'wrong_password' ? 'Sai m·∫≠t kh·∫©u' :
                'ƒêƒÉng nh·∫≠p th·∫•t b·∫°i';
          return;
        }

        // L∆∞u ng∆∞·ªùi d√πng
        localStorage.setItem('ms_user', JSON.stringify(d));
        renderUser();

        // N·∫øu l√† manager/admin -> chuy·ªÉn sang trang qu·∫£n tr·ªã
        if (['manager', 'admin'].includes((d.role || '').toLowerCase())) {
          window.location.href = '/pages/manager/manager.html';
          return;
        }

        // Ng∆∞·ª£c l·∫°i, ƒë√≥ng modal
        loginMsg.textContent = '‚úÖ ƒêƒÉng nh·∫≠p th√†nh c√¥ng';
        setTimeout(() => document.querySelector('#auth-modal')?.classList.add('hidden'), 600);
      } catch (err) {
        loginMsg.textContent = 'L·ªói m·∫°ng, th·ª≠ l·∫°i.';
      }
    });

    // REGISTER
    $$('#form-register')?.addEventListener('submit', async (e) => {
      e.preventDefault();
      registerMsg.textContent = 'ƒêang t·∫°o t√†i kho·∫£n...';
      const fd = new FormData(e.target);
      const payload = {
        fullName: fd.get('fullName'),
        email: fd.get('email'),
        phone: fd.get('phone'),
        password: fd.get('password'),
      };
      try {
        const r = await fetch(API + '/auth/register', {
          method: 'POST', headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });
        const d = await r.json();
        if (!r.ok) {
          registerMsg.textContent =
            d.error === 'email_exists' ? 'Email ƒë√£ t·ªìn t·∫°i' :
              d.detail || 'T·∫°o t√†i kho·∫£n th·∫•t b·∫°i';
          return;
        }
        registerMsg.textContent = '‚úÖ T·∫°o t√†i kho·∫£n th√†nh c√¥ng. H√£y ƒëƒÉng nh·∫≠p.';
        switchTab('login');
      } catch (err) {
        registerMsg.textContent = 'L·ªói m·∫°ng, th·ª≠ l·∫°i.';
      }
    });

    // FORGOT
    $$('#btnForgot')?.addEventListener('click', async () => {
      const email = ($$('#form-login input[name="email"]')?.value || '').trim();
      const input = email || prompt('Nh·∫≠p email ƒë·ªÉ ƒë·∫∑t l·∫°i m·∫≠t kh·∫©u:');
      if (!input) return;
      try {
        await fetch(API + '/auth/forgot', {
          method: 'POST', headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email: input })
        });
        alert('N·∫øu email t·ªìn t·∫°i, li√™n k·∫øt ƒë·∫∑t l·∫°i m·∫≠t kh·∫©u ƒë√£ ƒë∆∞·ª£c g·ª≠i.');
      } catch {
        alert('Kh√¥ng g·ª≠i ƒë∆∞·ª£c y√™u c·∫ßu. Th·ª≠ l·∫°i sau.');
      }
    });
  </script>
</body>

</html>