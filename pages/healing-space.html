<!DOCTYPE html>
<html lang="vi">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Healing Space | Music Space</title>

  <!-- Base styles -->
  <link rel="stylesheet" href="../assets/style.css" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <style>
    /* --- hero card l·ªõn --- */
    .hero-box {
      max-width: 1100px;
      margin: 20px auto 0;
      background: linear-gradient(135deg, #e7f6f2, #f5f2ea);
      border-radius: 22px;
      padding: 48px 28px;
      box-shadow: 0 18px 40px rgba(15, 23, 42, .08), inset 0 1px 0 rgba(255, 255, 255, .7);
      text-align: center;
    }

    .hero-icon {
      width: 60px;
      height: 60px;
      border-radius: 18px;
      display: grid;
      place-items: center;
      margin: 0 auto 16px;
      background: #fff;
      box-shadow: 0 10px 22px rgba(0, 0, 0, .08);
      color: #2563eb;
      font-size: 30px;
    }

    .hero-title {
      font-size: 40px;
      font-weight: 800;
      margin: 6px 0 8px;
      color: #0f172a;
    }

    .hero-sub {
      color: #475569;
      font-size: 16px;
    }

    /* --- thanh search + filter pill --- */
    .search-wrap {
      max-width: 1100px;
      margin: 22px auto 0;
      display: grid;
      grid-template-columns: 1fr auto auto;
      gap: 14px;
      align-items: center;
    }

    .search-input {
      display: flex;
      align-items: center;
      gap: 10px;
      background: #fff;
      border: 1px solid #e2e8f0;
      border-radius: 999px;
      padding: 12px 16px;
      box-shadow: 0 10px 22px rgba(0, 0, 0, .06);
    }

    .search-input input {
      width: 100%;
      border: 0;
      outline: 0;
      font-size: 14px;
      color: #0f172a;
      background: transparent;
    }

    .pill {
      background: #fff;
      border: 1px solid #e2e8f0;
      border-radius: 999px;
      padding: 10px 14px;
      display: flex;
      align-items: center;
      gap: 10px;
      box-shadow: 0 10px 22px rgba(0, 0, 0, .06);
    }

    .pill select {
      border: 0;
      background: transparent;
      outline: none;
      font-size: 14px;
      color: #0f172a;
    }

    /* --- toggle b·∫£n ƒë·ªì / danh s√°ch --- */
    .view-toggle {
      max-width: 1100px;
      margin: 16px auto 12px;
      display: flex;
      gap: 12px;
      justify-content: flex-start;
    }

    .toggle-btn {
      background: #fff;
      border: 1px solid #e2e8f0;
      border-radius: 14px;
      padding: 10px 14px;
      display: flex;
      align-items: center;
      gap: 8px;
      box-shadow: 0 10px 22px rgba(0, 0, 0, .06);
      cursor: pointer;
      font-weight: 600;
    }

    .toggle-btn.active {
      border-color: #bbf7d0;
      background: #ecfdf5;
    }

    /* --- map box --- */
    #map {
      height: 560px;
      max-width: 1100px;
      margin: 0 auto 36px;
      border-radius: 22px;
      box-shadow: 0 24px 60px rgba(0, 0, 0, .08);
    }

    /* --- event grid (danh s√°ch) --- */
    .hs-events.container {
      max-width: 1100px;
      margin: 0 auto 60px;
    }

    .hs-events-head {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
    }

    .hs-events-icon {
      width: 38px;
      height: 38px;
      border-radius: 10px;
      background: #fff;
      display: grid;
      place-items: center;
      box-shadow: 0 6px 14px rgba(0, 0, 0, .06);
    }

    .hs-cards {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 18px;
    }

    .hs-card {
      background: #fff;
      border: 1px solid #f1eae0;
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 12px 28px rgba(0, 0, 0, .06);
    }

    .hs-card img {
      width: 100%;
      height: 140px;
      object-fit: cover;
    }

    .hs-card .p {
      padding: 12px 14px;
    }

    .hs-card h3 {
      margin: 0 0 6px;
      font-size: 16px;
      color: #0f172a;
    }

    .hs-card .meta {
      font-size: 12px;
      color: #64748b;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .partner-cta.container {
      max-width: 1100px;
      margin: 20px auto 60px;
    }

    .partner-cta__inner {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #fff;
      border: 1px solid #e2e8f0;
      border-radius: 16px;
      padding: 16px 18px;
      box-shadow: 0 12px 28px rgba(0, 0, 0, .06);
    }

    .partner-cta__title {
      font-weight: 800;
      font-size: 18px;
    }

    .partner-cta__btn {
      padding: 10px 14px;
      border-radius: 10px;
      background: #0ea5e9;
      color: #fff;
      text-decoration: none;
      font-weight: 700;
    }

    @media (max-width:1024px) {
      .hero-title {
        font-size: 32px;
      }

      .search-wrap {
        grid-template-columns: 1fr;
      }

      .hs-cards {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>

<body>
  <!-- B·∫Øt bu·ªôc ƒëƒÉng nh·∫≠p -->
  <script>
    try {
      const u = JSON.parse(localStorage.getItem('ms_user') || 'null');
      if (!u) location.replace('../index.html#login');
    } catch { location.replace('../index.html#login'); }
  </script>

  <!-- NAVBAR -->
  <nav class="navbar">
    <div class="nav-inner">
      <a class="brand" href="../index.html">
        <span class="logo">‚ù§</span>
        <span><strong>Music</strong> <span class="space">Space</span></span>
      </a>

      <div class="nav-links">
        <a href="#" class="chip">‚ú® I'm Healing</a>
        <a href="healing-space.html" class="chip" id="linkHealing">üó∫ Healing Space</a>
        <a href="#" class="chip">üë• We Share</a>
        <a href="#" class="chip">üìñ We Read</a>
      </div>

      <div class="nav-actions">
        <button class="icon-btn">üîà</button>
        <div class="user-box">
          <button class="icon-btn" id="btnUser">üë§</button>
          <div id="user-info"></div>
        </div>
      </div>
    </div>
  </nav>

  <!-- HERO CARD -->
  <section class="hero-box">
    <div class="hero-icon">üìç</div>
    <div class="hero-title">Healing Space</div>
    <div class="hero-sub">Kh√°m ph√° kh√¥ng gian v√† s·ª± ki·ªán √¢m nh·∫°c ch·ªØa l√†nh tr√™n to√†n Vi·ªát Nam</div>
  </section>

  <!-- SEARCH + FILTER -->
  <section class="search-wrap">
    <div class="search-input">
      <span style="opacity:.6">üîé</span>
      <input id="search-q" placeholder="T√¨m ki·∫øm theo t√™n, ƒë·ªãa ch·ªâ..." />
    </div>

    <div class="pill">
      <span>üìç</span>
      <select id="filter-city">
        <option value="">T·∫•t c·∫£ khu v·ª±c</option>
        <!-- JS s·∫Ω fill 63 t·ªânh/th√†nh -->
      </select>
    </div>

    <div class="pill">
      <span>üóÇ</span>
      <select id="filter-category">
        <option value="">T·∫•t c·∫£ lo·∫°i</option>
        <option value="Sound Healing">Sound Healing</option>
        <option value="Meditation">Meditation</option>
        <option value="Acoustic Session">Acoustic Session</option>
      </select>
    </div>
  </section>

  <!-- TOGGLE (cu·ªôn t·ªõi khu v·ª±c) -->
  <div class="view-toggle">
    <button class="toggle-btn active" id="view-map"><span>üó∫</span> B·∫£n ƒë·ªì</button>
    <button class="toggle-btn" id="view-list"><span>üìã</span> Danh s√°ch</button>
    <button class="chip" id="btn-apply" style="margin-left:8px; display:none;">√Åp d·ª•ng</button>
  </div>

  <!-- MAP -->
  <div id="map"></div>

  <!-- EVENTS GRID -->
  <section class="hs-events container">
    <div class="hs-events-head">
      <div class="hs-events-icon">üìÖ</div>
      <h2>S·ª± ki·ªán ch·ªØa l√†nh s·∫Øp t·ªõi</h2>
    </div>
    <div id="events-grid" class="hs-cards"></div>
  </section>

  <!-- PARTNER CTA -->
  <section class="partner-cta container">
    <div class="partner-cta__inner">
      <div class="partner-cta__text">
        <div class="partner-cta__title">B·∫°n l√† ch·ªß kh√¥ng gian?</div>
        <p>Tr·ªü th√†nh Space Partner ƒë·ªÉ ti·∫øp c·∫≠n c·ªông ƒë·ªìng v√† t·ªï ch·ª©c s·ª± ki·ªán ch·ªØa l√†nh.</p>
      </div>
      <a class="partner-cta__btn" href="/pages/partner-register.html">ƒêƒÉng k√Ω l√†m ƒë·ªëi t√°c</a>
    </div>
  </section>

  <!-- FOOTER -->
  <footer class="footer">
    <div class="footer-inner">
      <!-- C·ªôt 1 -->
      <div class="footer-col">
        <div class="brand-footer">
          <span class="logo">‚ù§</span>
          <div>
            <div class="brand-text"><strong>Music</strong> <span class="space">Space</span></div>
            <p class="tagline">Vietnam's Healing Music Map</p>
          </div>
        </div>
        <p class="desc">
          N·ªÅn t·∫£ng k·∫øt n·ªëi c·∫£m x√∫c, kh√¥ng gian v√† c·ªông ƒë·ªìng th√¥ng qua giai ƒëi·ªáu ch·ªØa l√†nh.
        </p>
        <div class="social">
          <a href="#"><i class="fab fa-facebook-f"></i></a>
          <a href="#"><i class="fab fa-instagram"></i></a>
          <a href="#"><i class="fab fa-messenger"></i></a>
          <a href="#"><i class="fab fa-youtube"></i></a>
        </div>
      </div>

      <!-- C·ªôt 2 -->
      <div class="footer-col">
        <h4>Kh√°m Ph√°</h4>
        <ul>
          <li><a href="#">I'm Healing</a></li>
          <li><a href="#">Healing Space</a></li>
          <li><a href="#">We Share</a></li>
        </ul>
      </div>

      <!-- C·ªôt 3 -->
      <div class="footer-col">
        <h4>V·ªÅ ch√∫ng t√¥i</h4>
        <ul>
          <li><a href="#">S·ª© m·ªánh</a></li>
          <li><a href="#">We Read</a></li>
        </ul>
      </div>

      <!-- C·ªôt 4 -->
      <div class="footer-col">
        <h4>ƒê·ªëi T√°c</h4>
        <ul>
          <li><a href="#">Tr·ªü th√†nh ƒë·ªëi t√°c</a></li>
          <li><a href="#">G√≥i th√†nh vi√™n</a></li>
        </ul>
      </div>
    </div>

    <div class="copyright">
      ¬© 2025 Music Space. All rights reserved.
    </div>
  </footer>

  <!-- AUTH MODAL (reuse) -->
  <div id="auth-modal" class="auth-modal hidden">
    <div class="auth-dialog">
      <button class="auth-close" aria-label="close">√ó</button>
      <div class="auth-tabs">
        <button data-tab="login" class="auth-tab active">ƒêƒÉng nh·∫≠p</button>
        <button data-tab="register" class="auth-tab">ƒêƒÉng k√Ω</button>
      </div>
      <form id="form-login" class="auth-pane show">
        <label>Email</label>
        <input type="email" name="email" required>
        <label>M·∫≠t kh·∫©u</label>
        <input type="password" name="password" required>
        <button type="submit" class="auth-btn">ƒêƒÉng nh·∫≠p</button>
        <p id="login-msg" class="auth-msg"></p>
      </form>
      <form id="form-register" class="auth-pane">
        <label>H·ªç t√™n</label>
        <input type="text" name="fullName" required>
        <label>Email</label>
        <input type="email" name="email" required>
        <label>S·ªë ƒëi·ªán tho·∫°i</label>
        <input type="text" name="phone">
        <label>M·∫≠t kh·∫©u</label>
        <input type="password" name="password" required>
        <button type="submit" class="auth-btn">T·∫°o t√†i kho·∫£n</button>
        <p id="register-msg" class="auth-msg"></p>
      </form>
    </div>
  </div>

  <!-- Script chung (auth, map init, load markers, guard link‚Ä¶) -->
  <script src="../js/script.js"></script>



  <script>
    // Toggle: ·∫©n/hi·ªán map
    const mapBtn = document.getElementById('view-map');
    const listBtn = document.getElementById('view-list');
    const mapEl = document.getElementById('map');
    const eventsEl = document.querySelector('.hs-events'); // c√≥ th·ªÉ null

    if (mapBtn && listBtn && mapEl) {
      function fixLeaflet() {
        // ch·ªâ invalidate khi map ƒëang nh√¨n th·∫•y
        if (window.map && typeof window.map.invalidateSize === 'function' &&
          mapEl.style.display !== 'none') {
          setTimeout(() => window.map.invalidateSize(true), 50);
        }
      }

      mapBtn.addEventListener('click', () => {
        mapBtn.classList.add('active');
        listBtn.classList.remove('active');

        // hi·ªán map, ·∫©n list (n·∫øu c√≥)
        mapEl.style.display = 'block';
        if (eventsEl) eventsEl.style.display = ''; // '' t·ªët h∆°n 'block' (theo CSS m·∫∑c ƒë·ªãnh)

        // c·∫ßn delay 1 nh·ªãp ƒë·ªÉ layout ·ªïn r·ªìi m·ªõi invalidate
        fixLeaflet();
        // (tu·ª≥ th√≠ch) cu·ªôn l√™n khu v·ª±c map
        // window.scrollTo({ top: mapEl.offsetTop - 60, behavior: 'smooth' });
      });

      listBtn.addEventListener('click', () => {
        listBtn.classList.add('active');
        mapBtn.classList.remove('active');

        // ·∫©n map, hi·ªán list (n·∫øu c√≥)
        mapEl.style.display = 'none';
        if (eventsEl) eventsEl.style.display = '';
        // kh√¥ng c·∫ßn invalidate khi ƒëang ·∫©n
        // (tu·ª≥ th√≠ch) window.scrollTo({ top: eventsEl?.offsetTop ?? 0, behavior: 'smooth' });
      });

      // invalidate khi kh·ªüi t·∫°o & khi resize/orientation
      window.addEventListener('load', () => setTimeout(fixLeaflet, 60));
      window.addEventListener('resize', () => setTimeout(fixLeaflet, 60));
      window.addEventListener('orientationchange', () => setTimeout(fixLeaflet, 60));

      // (khuy√™n d√πng) invalidate khi map v√†o viewport
      if ('IntersectionObserver' in window) {
        const io = new IntersectionObserver((ents) => {
          if (ents[0].isIntersecting) setTimeout(fixLeaflet, 50);
        }, { threshold: 0.2 });
        io.observe(mapEl);
      }
    }
  </script>





  <!-- B·ªï sung ri√™ng cho trang n√†y -->
  <script>
    // 63 t·ªânh/th√†nh ‚Äî fill v√†o #filter-city
    const VN_PROVINCES = [
      "An Giang", "B√† R·ªãa - V≈©ng T√†u", "B·∫Øc Giang", "B·∫Øc K·∫°n", "B·∫°c Li√™u", "B·∫Øc Ninh", "B·∫øn Tre", "B√¨nh D∆∞∆°ng", "B√¨nh ƒê·ªãnh", "B√¨nh Ph∆∞·ªõc", "B√¨nh Thu·∫≠n", "C√† Mau",
      "C·∫ßn Th∆°", "Cao B·∫±ng", "ƒê√† N·∫µng", "ƒê·∫Øk L·∫Øk", "ƒê·∫Øk N√¥ng", "ƒêi·ªán Bi√™n", "ƒê·ªìng Nai", "ƒê·ªìng Th√°p", "Gia Lai", "H√† Giang", "H√† Nam", "H√† N·ªôi", "H√† Tƒ©nh",
      "H·∫£i D∆∞∆°ng", "H·∫£i Ph√≤ng", "H·∫≠u Giang", "H√≤a B√¨nh", "H∆∞ng Y√™n", "Kh√°nh H√≤a", "Ki√™n Giang", "Kon Tum", "Lai Ch√¢u", "L√¢m ƒê·ªìng", "L·∫°ng S∆°n", "L√†o Cai",
      "Long An", "Nam ƒê·ªãnh", "Ngh·ªá An", "Ninh B√¨nh", "Ninh Thu·∫≠n", "Ph√∫ Th·ªç", "Ph√∫ Y√™n", "Qu·∫£ng B√¨nh", "Qu·∫£ng Nam", "Qu·∫£ng Ng√£i", "Qu·∫£ng Ninh", "Qu·∫£ng Tr·ªã",
      "S√≥c TrƒÉng", "S∆°n La", "T√¢y Ninh", "Th√°i B√¨nh", "Th√°i Nguy√™n", "Thanh H√≥a", "Th·ª´a Thi√™n Hu·∫ø", "Ti·ªÅn Giang", "TP. H·ªì Ch√≠ Minh", "Tr√† Vinh", "Tuy√™n Quang",
      "Vƒ©nh Long", "Vƒ©nh Ph√∫c", "Y√™n B√°i"
    ];
    (function fillProvinces() {
      const sel = document.getElementById('filter-city');
      if (!sel) return;
      VN_PROVINCES.sort((a, b) => a.localeCompare(b, 'vi')).forEach(p => {
        const opt = document.createElement('option');
        opt.value = p; opt.textContent = p; sel.appendChild(opt);
      });
    })();

    // Toggle: ch·ªâ cu·ªôn t·ªõi v√πng t∆∞∆°ng ·ª©ng, KH√îNG ·∫©n map
    const mapBtn = document.getElementById('view-map');
    const listBtn = document.getElementById('view-list');
    mapBtn?.addEventListener('click', () => {
      mapBtn.classList.add('active');
      listBtn.classList.remove('active');
      window.scrollTo({ top: document.getElementById('map').offsetTop - 60, behavior: 'smooth' });
    });
    listBtn?.addEventListener('click', () => {
      listBtn.classList.add('active');
      mapBtn.classList.remove('active');
      window.scrollTo({ top: document.querySelector('.hs-events').offsetTop - 60, behavior: 'smooth' });
    });

    // Render ‚ÄúS·ª± ki·ªán s·∫Øp t·ªõi‚Äù (l·∫•y c√πng API /healing-events)
    async function loadUpcoming() {
      try {
        const res = await fetch('/api/healing-events'); // kh√¥ng c·∫ßn query r·ªóng
        const data = await res.json();
        const grid = document.getElementById('events-grid');
        grid.innerHTML = '';

        const list = Array.isArray(data) ? data : [];
        if (!list.length) {
          grid.innerHTML = `<p style="grid-column:1/-1;color:#64748b">Ch∆∞a c√≥ s·ª± ki·ªán.</p>`;
          return;
        }

        list.slice(0, 9).forEach(ev => {
          const title = ev.title || 'S·ª± ki·ªán';
          const city = ev.city || '';
          const venue = ev.venue_name || '';
          const slug = ev.slug;
          const thumb = ev.thumbnail_url;     // v√≠ d·ª•: /uploads/xxx.jpg
          const start = ev.start_time ? new Date(ev.start_time).toLocaleString('vi-VN') : '';
          const price = Number.isFinite(ev.price_cents)
            ? (ev.price_cents / 100).toLocaleString('vi-VN') + ' ' + (ev.currency || 'VND')
            : 'Mi·ªÖn ph√≠';

          const card = document.createElement('article');
          card.className = 'hs-card';
          card.innerHTML = `
          ${thumb ? `<img src="${thumb}" alt="${title}">` : ''}
          <div class="p">
            <h3>${title}</h3>
            <div class="meta">
              ${venue || city ? `<span>üìç ${[venue, city].filter(Boolean).join(', ')}</span>` : ''}
              ${start ? `<span>üóì ${start}</span>` : ''}
              <span>üíµ ${price}</span>
            </div>
            ${slug ? `<a class="arrow" href="/pages/event.html?slug=${encodeURIComponent(slug)}" style="display:inline-block;margin-top:8px;">Xem chi ti·∫øt ‚Üí</a>` : ''}
          </div>
        `;
          grid.appendChild(card);
        });
      } catch (e) {
        console.warn('loadUpcoming error', e);
        document.getElementById('events-grid').innerHTML =
          `<p style="grid-column:1/-1;color:#ef4444">Kh√¥ng t·∫£i ƒë∆∞·ª£c danh s√°ch s·ª± ki·ªán.</p>`;
      }
    }
    document.addEventListener('DOMContentLoaded', loadUpcoming);
  </script>
</body>

</html>